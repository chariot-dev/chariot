{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\hojoh\\\\Desktop\\\\Senior Design\\\\chariot\\\\gui\\\\src\\\\components\\\\deviceManagement\\\\AddDeviceHome.js\";\n\n/*\n  AddDeviceHome.js\n\n  This component is the first screen the user will see when creating a device.\n  This component handles the GUI for creating a device, as well as the modals \n  that appear as the process is completed. In order to get the specific\n  device fields, AddDeviceVars is a child component.\n\n  Currently, only a single device can be created before the user is sent back\n  to the Welcome screen.\n*/\nimport React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport Modal from 'react-bootstrap/Modal';\nimport Button from 'react-bootstrap/Button';\nimport AddDeviceVars from './AddDeviceVars';\nimport ConfirmationModalBody from '../shared/ConfirmationModalBody';\nimport SuccessModalBody from '../shared/SuccessModalBody';\nimport ErrorModalBody from '../shared/ErrorModalBody';\nconst getDeviceConfigBaseUrl = 'http://localhost:5000/chariot/api/v1.0/network/device/config';\nconst postDeviceCreationBaseUrl = \"http://localhost:5000/chariot/api/v1.0/network/device\";\nconst xhr = new XMLHttpRequest();\n\nclass AddDeviceHome extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleNewDeviceCreation = submittedDeviceSpecificState => {\n      console.log(submittedDeviceSpecificState);\n      this.setState({\n        deviceState: submittedDeviceSpecificState\n      }, () => {\n        console.log(this.state.deviceState);\n      }); // Update state to launch confirmation modal\n\n      this.setState({\n        isSubmitted: !this.state.isSubmitted,\n        confirmIsOpen: !this.state.confirmIsOpen\n      });\n    };\n\n    this.toggleSuccessModal = () => {\n      xhr.open('POST', postDeviceCreationBaseUrl, true);\n      xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n\n      xhr.onreadystatechange = () => {\n        // Call a function when the state changes.\n        if (xhr.readyState === XMLHttpRequest.DONE) {\n          if (xhr.status === 200) {\n            this.setState({\n              confirmIsOpen: false\n            });\n            this.setState({\n              successIsOpen: !this.state.successIsOpen\n            });\n          }\n        }\n      };\n\n      var data = {};\n      data[\"networkName\"] = this.props.location.networkProps[\"Network Name\"];\n      data[\"deviceType\"] = this.state.deviceState.newDeviceTypeGeneralVals['Device Type'];\n      console.log(this.props.location.networkProps);\n      console.log(this.state.deviceState.newDeviceTypeConfigVals);\n\n      for (var key in this.state.deviceState.newDeviceTypeConfigVals) {\n        console.log(key);\n        console.log(this.state.deviceState.newDeviceTypeConfigVals[key]);\n        var fieldVal = this.state.deviceState.newDeviceTypeConfigVals[key].value; //only add to data if the value is not empty\n\n        if (fieldVal !== \"\") {\n          //TODO: find a better way to do this\n          var curFieldId = this.state.deviceState.newDeviceTypeConfigVals[key].alias;\n          var fieldType = this.state.deviceState.newDeviceTypeConfigVals[key].inputType;\n\n          if (fieldType === \"number\") {\n            fieldVal = parseInt(fieldVal);\n          } else if (fieldType === \"checkbox\") {\n            fieldVal = document.getElementById(curFieldId).checked;\n          } else if (fieldType === \"numberArray\") {\n            var inputValues = fieldVal.split(\" \"); //again need to verify that all values will be ints\n\n            var arr = [];\n            inputValues.forEach(function (item) {\n              arr.push(parseInt(item));\n            });\n            fieldVal = arr;\n          }\n\n          data[curFieldId] = fieldVal;\n        }\n      }\n\n      xhr.send(JSON.stringify(data));\n    };\n\n    this.toggleErrorModal = () => {\n      this.setState({\n        confirmIsOpen: false\n      });\n      this.setState({\n        errorIsOpen: !this.state.errorIsOpen\n      });\n    };\n\n    this.parseConfirmationData = () => {\n      var confirmationDataJson = {};\n      confirmationDataJson['Device Type'] = this.state.newDeviceTypeGeneralVals['Device Type'];\n\n      for (var key in this.state.deviceState.newDeviceTypeConfigVals) {\n        confirmationDataJson[key] = this.state.deviceState.newDeviceTypeConfigVals[key].value;\n      }\n\n      return confirmationDataJson;\n    };\n\n    this.state = {\n      newDeviceTypeGeneralVals: {\n        newDeviceTypeConfig: null\n      },\n      showDeviceSpecificSettings: false,\n      // Whether or not the type of device has been chosen by the user already\n      isSubmitted: false,\n      // Whether or not the device information is ready to be sent to the server\n      confirmIsOpen: false,\n      // Is the confirm modal open?\n      successIsOpen: false,\n      // Is the success modal open?\n      errorIsOpen: false,\n      // Is the error modal open?\n      deviceState: {} // All configuration setting values for the device (From AddDeviceHome and AddDeviceVars)\n\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleDeviceTypeChange = this.handleDeviceTypeChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n  /*\n    Updates textfield state values as they are entered by the user.\n  */\n\n\n  handleChange(event) {\n    var updatedNewDeviceTypeGeneralVals = this.state.newDeviceTypeGeneralVals; // Store from current state\n\n    updatedNewDeviceTypeGeneralVals[event.target.name] = event.target.value; // Update the json\n\n    this.setState({\n      newDeviceTypeGeneralVals: updatedNewDeviceTypeGeneralVals\n    }); // Update the state\n  }\n  /*\n    As the device type the user selects changes, update that in the state.\n  */\n\n\n  handleDeviceTypeChange(event) {\n    console.log(\"------------------- changed -------------------\");\n    var lastDeviceType = this.state.newDeviceTypeGeneralVals['Device Type'];\n\n    if (lastDeviceType !== event.target.value) {\n      var updatedNewDeviceTypeGeneralVals = this.state.newDeviceTypeGeneralVals; // Store from current state\n\n      updatedNewDeviceTypeGeneralVals[event.target.name] = event.target.value; // Update the json with the new device type\n      // State is update asynchronousyly, so run function after state is updated\n\n      this.setState({\n        newDeviceTypeGeneralVals: updatedNewDeviceTypeGeneralVals\n      }, function () {\n        console.log(this.state.newDeviceTypeGeneralVals);\n        xhr.open('GET', getDeviceConfigBaseUrl + \"?deviceId=\" + this.state.newDeviceTypeGeneralVals['Device Type']);\n        xhr.setRequestHeader('Content-Type', 'application/json'); // Once a response is received\n\n        xhr.onreadystatechange = () => {\n          if (xhr.readyState === XMLHttpRequest.DONE) {\n            // Once the request is done\n            var responseJson = JSON.parse(xhr.response);\n            console.log(responseJson);\n            console.log(updatedNewDeviceTypeGeneralVals);\n            updatedNewDeviceTypeGeneralVals['newDeviceTypeConfig'] = responseJson;\n            console.log(updatedNewDeviceTypeGeneralVals); // Store the device's config file to the state\n\n            this.setState({\n              newDeviceTypeGeneralVals: updatedNewDeviceTypeGeneralVals\n            });\n            this.setState({\n              showDeviceSpecificSettings: true\n            }); // Will cause render to update device-specific section\n          }\n        };\n\n        xhr.send(); // Send the request to the url with set headers\n\n        this.setState({\n          showDeviceSpecificSettings: false\n        }); // Reset to false after render to get ready for next render\n      });\n    }\n  }\n\n  /* \n    Called when the user either submits the registration form by clicking \"Next\"\n    in the AddDeviceVars component or \"No\" on the confirmation modal. Will change the \n    \"isSubmitted\" prop to true->false or false->true. Also will update the viewability\n    status of the confirmation modal\n  */\n  handleSubmit(event) {\n    this.setState({\n      isSubmitted: !this.state.isSubmitted,\n      confirmIsOpen: !this.state.confirmIsOpen\n    });\n    event.preventDefault();\n  }\n\n  /*\n    Returns three separate objects with their unique keys. The first object\n    is the Device Creation screen itself. This screen contains the fields that\n    the user will have to fill in, in order to create a device. It also contains \n    AddDeviceVars component, which contains the \"Next\" button that will lead the \n    user to the other two objects, the confirmation and sucess modals.\n  */\n  render() {\n    // If config for device type (e.g. Impinjxarray) was obtained, load the form with the device-specific section\n    return [React.createElement(\"div\", {\n      className: \"container\",\n      key: \"newDeviceScreen\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225\n      },\n      __self: this\n    }, \"Configure New Device Settings\"), React.createElement(\"p\", {\n      className: \"screenInfo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    }, \"Please fill in the configuration fields for your new device.\"), React.createElement(\"form\", {\n      id: \"createDeviceForm\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"form-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, React.createElement(\"select\", {\n      required: true,\n      className: \"form-control\",\n      id: \"Device Type Select\",\n      name: \"Device Type\",\n      onChange: this.handleDeviceTypeChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }, React.createElement(\"option\", {\n      selected: true,\n      disabled: true,\n      hidden: true,\n      value: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }, \"Select a Device Type\"), React.createElement(\"option\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }, \"ImpinjSpeedwayR420\"), React.createElement(\"option\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, \"ImpinjXArray\"))), this.state.showDeviceSpecificSettings ? React.createElement(AddDeviceVars, {\n      params: this.state,\n      onFormSubmit: this.handleNewDeviceCreation,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    }) : null), React.createElement(Link, {\n      to: \"/networkManager\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }, React.createElement(Button, {\n      variant: \"primary\",\n      className: \"float-left footer-button\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }, \"Back\"))), React.createElement(Modal, {\n      show: this.state.confirmIsOpen,\n      key: \"newDeviceConfirmModal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, React.createElement(ConfirmationModalBody, {\n      confirmationQuestion: 'Before '.concat(this.state.newDeviceTypeGeneralVals['Device Nickname'], ' is added to ', this.props.location.networkProps['Network Name'], ' please confirm that the information below is correct.'),\n      confirmationData: this.parseConfirmationData(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }), React.createElement(Modal.Footer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254\n      },\n      __self: this\n    }, React.createElement(Button, {\n      variant: \"primary\",\n      className: \"float-left\",\n      onClick: this.handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255\n      },\n      __self: this\n    }, \"Incorrect\"), React.createElement(Button, {\n      variant: \"primary\",\n      className: \"float-right\",\n      onClick: this.toggleSuccessModal,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256\n      },\n      __self: this\n    }, \"Correct\"))), React.createElement(Modal, {\n      show: this.state.successIsOpen,\n      key: \"registerSuccessModal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260\n      },\n      __self: this\n    }, React.createElement(SuccessModalBody, {\n      successMessage: \"Your new device has been created and added to the network!\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261\n      },\n      __self: this\n    }), React.createElement(Modal.Footer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: \"/welcome\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264\n      },\n      __self: this\n    }, React.createElement(Button, {\n      variant: \"primary\",\n      className: \"float-right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }, \"Continue\")))), React.createElement(Modal, {\n      show: this.state.errorIsOpen,\n      key: \"addDeviceErrorModal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270\n      },\n      __self: this\n    }, React.createElement(ErrorModalBody, {\n      errorMessage: \"Your device was not added to the network. Please go back, verify that the information is correct, and then try again.\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272\n      },\n      __self: this\n    }), React.createElement(Modal.Footer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275\n      },\n      __self: this\n    }, React.createElement(Button, {\n      variant: \"primary\",\n      className: \"float-left\",\n      onClick: this.toggleErrorModal,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 276\n      },\n      __self: this\n    }, \"OK\")))];\n  }\n\n}\n\nexport default AddDeviceHome;","map":{"version":3,"sources":["C:\\Users\\hojoh\\Desktop\\Senior Design\\chariot\\gui\\src\\components\\deviceManagement\\AddDeviceHome.js"],"names":["React","Component","Link","Modal","Button","AddDeviceVars","ConfirmationModalBody","SuccessModalBody","ErrorModalBody","getDeviceConfigBaseUrl","postDeviceCreationBaseUrl","xhr","XMLHttpRequest","AddDeviceHome","constructor","props","handleNewDeviceCreation","submittedDeviceSpecificState","console","log","setState","deviceState","state","isSubmitted","confirmIsOpen","toggleSuccessModal","open","setRequestHeader","onreadystatechange","readyState","DONE","status","successIsOpen","data","location","networkProps","newDeviceTypeGeneralVals","newDeviceTypeConfigVals","key","fieldVal","value","curFieldId","alias","fieldType","inputType","parseInt","document","getElementById","checked","inputValues","split","arr","forEach","item","push","send","JSON","stringify","toggleErrorModal","errorIsOpen","parseConfirmationData","confirmationDataJson","newDeviceTypeConfig","showDeviceSpecificSettings","handleChange","bind","handleDeviceTypeChange","handleSubmit","event","updatedNewDeviceTypeGeneralVals","target","name","lastDeviceType","responseJson","parse","response","preventDefault","render","concat"],"mappings":"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","sourcesContent":["/*\n  AddDeviceHome.js\n\n  This component is the first screen the user will see when creating a device.\n  This component handles the GUI for creating a device, as well as the modals \n  that appear as the process is completed. In order to get the specific\n  device fields, AddDeviceVars is a child component.\n\n  Currently, only a single device can be created before the user is sent back\n  to the Welcome screen.\n*/\n\nimport React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport Modal from 'react-bootstrap/Modal';\nimport Button from 'react-bootstrap/Button';\nimport AddDeviceVars from './AddDeviceVars';\n\nimport ConfirmationModalBody from '../shared/ConfirmationModalBody';\nimport SuccessModalBody from '../shared/SuccessModalBody';\nimport ErrorModalBody from '../shared/ErrorModalBody';\n\nconst getDeviceConfigBaseUrl = 'http://localhost:5000/chariot/api/v1.0/network/device/config';\nconst postDeviceCreationBaseUrl = \"http://localhost:5000/chariot/api/v1.0/network/device\";\nconst xhr = new XMLHttpRequest();\n\nclass AddDeviceHome extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      newDeviceTypeGeneralVals: {\n        newDeviceTypeConfig: null\n      },\n      showDeviceSpecificSettings: false, // Whether or not the type of device has been chosen by the user already\n      isSubmitted: false, // Whether or not the device information is ready to be sent to the server\n      confirmIsOpen: false, // Is the confirm modal open?\n      successIsOpen: false, // Is the success modal open?\n      errorIsOpen: false, // Is the error modal open?\n      deviceState: {} // All configuration setting values for the device (From AddDeviceHome and AddDeviceVars)\n    }\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleDeviceTypeChange = this.handleDeviceTypeChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  /*\n    Updates textfield state values as they are entered by the user.\n  */  \n  handleChange(event) {\n    var updatedNewDeviceTypeGeneralVals = this.state.newDeviceTypeGeneralVals; // Store from current state\n    updatedNewDeviceTypeGeneralVals[event.target.name] = event.target.value; // Update the json\n    \n    this.setState({ newDeviceTypeGeneralVals: updatedNewDeviceTypeGeneralVals }); // Update the state\n  }\n\n\n  /*\n    As the device type the user selects changes, update that in the state.\n  */\n  handleDeviceTypeChange(event) {\n    console.log(\"------------------- changed -------------------\");\n    var lastDeviceType = this.state.newDeviceTypeGeneralVals['Device Type'];\n    \n    if (lastDeviceType !== event.target.value) {\n      var updatedNewDeviceTypeGeneralVals = this.state.newDeviceTypeGeneralVals; // Store from current state\n      updatedNewDeviceTypeGeneralVals[event.target.name] = event.target.value; // Update the json with the new device type\n\n      // State is update asynchronousyly, so run function after state is updated\n      this.setState({ newDeviceTypeGeneralVals: updatedNewDeviceTypeGeneralVals }, function () {\n        console.log(this.state.newDeviceTypeGeneralVals);\n\n        xhr.open('GET', getDeviceConfigBaseUrl + \"?deviceId=\" + this.state.newDeviceTypeGeneralVals['Device Type']);\n        xhr.setRequestHeader('Content-Type', 'application/json');\n        \n        // Once a response is received\n        xhr.onreadystatechange = () => {\n          if (xhr.readyState === XMLHttpRequest.DONE) { // Once the request is done\n              var responseJson = JSON.parse(xhr.response);\n\n              console.log(responseJson);\n\n              console.log(updatedNewDeviceTypeGeneralVals);\n\n              updatedNewDeviceTypeGeneralVals['newDeviceTypeConfig'] = responseJson;\n\n              console.log(updatedNewDeviceTypeGeneralVals);\n\n              // Store the device's config file to the state\n              this.setState({newDeviceTypeGeneralVals: updatedNewDeviceTypeGeneralVals});\n              this.setState({showDeviceSpecificSettings: true}); // Will cause render to update device-specific section\n          }\n        }\n\n        xhr.send(); // Send the request to the url with set headers\n\n        this.setState({ showDeviceSpecificSettings: false}); // Reset to false after render to get ready for next render\n      });\n    }\n  }\n\n  handleNewDeviceCreation = (submittedDeviceSpecificState) => {\n    console.log(submittedDeviceSpecificState);\n    this.setState ({ deviceState: submittedDeviceSpecificState }, () => {\n      console.log(this.state.deviceState);\n    });\n\n    // Update state to launch confirmation modal\n    this.setState({\n      isSubmitted: !this.state.isSubmitted,\n      confirmIsOpen: !this.state.confirmIsOpen\n    }); \n  }\n\n\n  /*\n    Function that launches the success modal after the user confirms the device\n    information that they entered is correct. Also makes the POST request to the\n    server to create the new device.\n  */\n toggleSuccessModal = () => {\n    xhr.open('POST', postDeviceCreationBaseUrl, true);\n    xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n\n    xhr.onreadystatechange = () => {// Call a function when the state changes.\n      if (xhr.readyState === XMLHttpRequest.DONE) {\n        if (xhr.status === 200) {\n          this.setState({ confirmIsOpen: false });\n          this.setState({ successIsOpen: !this.state.successIsOpen });\n        }\n      }\n    }    \n    \n    var data = {};\n    data[\"networkName\"] = this.props.location.networkProps[\"Network Name\"];\n    data[\"deviceType\"] = this.state.deviceState.newDeviceTypeGeneralVals['Device Type'];\n\n    console.log(this.props.location.networkProps);\n    console.log(this.state.deviceState.newDeviceTypeConfigVals);\n\n    for (var key in this.state.deviceState.newDeviceTypeConfigVals) {\n      console.log(key);\n      console.log(this.state.deviceState.newDeviceTypeConfigVals[key]);\n\n      var fieldVal = this.state.deviceState.newDeviceTypeConfigVals[key].value;\n\n      //only add to data if the value is not empty\n      if (fieldVal !== \"\") {\n          //TODO: find a better way to do this\n          var curFieldId = this.state.deviceState.newDeviceTypeConfigVals[key].alias;\n          var fieldType = this.state.deviceState.newDeviceTypeConfigVals[key].inputType;\n          if (fieldType === \"number\") {\n              fieldVal = parseInt(fieldVal)\n          }\n          else if (fieldType === \"checkbox\") {\n              fieldVal = document.getElementById(curFieldId).checked;\n          }\n          else if (fieldType === \"numberArray\") {\n              var inputValues = fieldVal.split(\" \");\n              //again need to verify that all values will be ints\n              var arr = [];\n\n              inputValues.forEach(function (item) {\n                  arr.push(parseInt(item))\n              });\n\n              fieldVal = arr;\n          }\n          data[curFieldId] = fieldVal;\n      }\n    }\n\n    xhr.send(JSON.stringify(data));\n  }\n\n  toggleErrorModal = () => {\n    this.setState({\n      confirmIsOpen: false\n    });\n    this.setState({\n      errorIsOpen: !this.state.errorIsOpen\n    });\n  }\n\n\n  /* \n    Called when the user either submits the registration form by clicking \"Next\"\n    in the AddDeviceVars component or \"No\" on the confirmation modal. Will change the \n    \"isSubmitted\" prop to true->false or false->true. Also will update the viewability\n    status of the confirmation modal\n  */\n  handleSubmit(event) {\n    this.setState({\n      isSubmitted: !this.state.isSubmitted,\n      confirmIsOpen: !this.state.confirmIsOpen\n    });    \n    event.preventDefault();\n  }\n\n\n  parseConfirmationData = () => {\n    var confirmationDataJson = {};\n\n    confirmationDataJson['Device Type'] = this.state.newDeviceTypeGeneralVals['Device Type'];\n\n    for (var key in this.state.deviceState.newDeviceTypeConfigVals) {\n      confirmationDataJson[key] = this.state.deviceState.newDeviceTypeConfigVals[key].value;\n    }\n\n    return confirmationDataJson;\n  }\n  \n\n  /*\n    Returns three separate objects with their unique keys. The first object\n    is the Device Creation screen itself. This screen contains the fields that\n    the user will have to fill in, in order to create a device. It also contains \n    AddDeviceVars component, which contains the \"Next\" button that will lead the \n    user to the other two objects, the confirmation and sucess modals.\n  */\n  render() {\n    // If config for device type (e.g. Impinjxarray) was obtained, load the form with the device-specific section\n    return [\n      <div className=\"container\" key=\"newDeviceScreen\">\n        <h1>Configure New Device Settings</h1>\n        <p className=\"screenInfo\">Please fill in the configuration fields for your new device.</p>\n\n        <form id=\"createDeviceForm\">\n          <div className=\"form-group\">\n              <select required className=\"form-control\" id=\"Device Type Select\" name=\"Device Type\" onChange={this.handleDeviceTypeChange}>\n                <option selected disabled hidden value=\"\">Select a Device Type</option>\n                <option>ImpinjSpeedwayR420</option>\n                <option>ImpinjXArray</option>\n              </select>\n          </div>\n\n            {/* onFormSubmit() callback. Pass in as prop basically. */}\n            {this.state.showDeviceSpecificSettings ? <AddDeviceVars params={this.state} onFormSubmit={this.handleNewDeviceCreation}></AddDeviceVars> : null}\n        </form>\n\n        <Link to=\"/networkManager\">\n          <Button variant=\"primary\" className=\"float-left footer-button\">Back</Button>\n        </Link>\n      </div>,\n\n      <Modal show={this.state.confirmIsOpen} key=\"newDeviceConfirmModal\">\n        \n        <ConfirmationModalBody\n          confirmationQuestion={('Before ').concat(this.state.newDeviceTypeGeneralVals['Device Nickname'], ' is added to ', this.props.location.networkProps['Network Name'], ' please confirm that the information below is correct.')} \n          confirmationData = {this.parseConfirmationData()}\n          >\n        </ConfirmationModalBody>\n\n        <Modal.Footer>\n          <Button variant=\"primary\" className=\"float-left\" onClick={this.handleSubmit}>Incorrect</Button>\n          <Button variant=\"primary\" className=\"float-right\" onClick={this.toggleSuccessModal}>Correct</Button>\n        </Modal.Footer>\n      </Modal>,\n\n      <Modal show={this.state.successIsOpen} key=\"registerSuccessModal\">\n        <SuccessModalBody successMessage=\"Your new device has been created and added to the network!\">\n        </SuccessModalBody>\n        <Modal.Footer>\n          <Link to=\"/welcome\">\n            <Button variant=\"primary\" className=\"float-right\">Continue</Button>\n          </Link>\n        </Modal.Footer>\n      </Modal>,\n\n      <Modal show={this.state.errorIsOpen} key=\"addDeviceErrorModal\">\n\n        <ErrorModalBody errorMessage=\"Your device was not added to the network. Please go back, verify that the information is correct, and then try again.\">\n        </ErrorModalBody>\n\n        <Modal.Footer>\n          <Button variant=\"primary\" className=\"float-left\" onClick={this.toggleErrorModal}>OK</Button>\n        </Modal.Footer>\n      </Modal>\n    ]\n  }\n}\n \nexport default AddDeviceHome; "]},"metadata":{},"sourceType":"module"}